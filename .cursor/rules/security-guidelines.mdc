---
alwaysApply: true
---

# セキュリティガイドライン

## 認証・認可
- **Google OIDC**を使用した認証システムの実装
- **JWT トークン**による認証状態の管理
- **PKCE (Proof Key for Code Exchange)**によるセキュリティ強化
- **State パラメータ**によるCSRF攻撃対策

## データ保護
- **HTTPS通信**の強制（TLS 1.2以上）
- **個人情報の暗号化**保存
- **機密情報の環境変数**管理
- **データベース接続の暗号化**

## 入力検証・サニタイゼーション
- **Pydantic**を使用したリクエストデータの検証
- **SQLインジェクション**対策（パラメータ化クエリ）
- **XSS攻撃**対策（適切なエスケープ処理）
- **CSRF攻撃**対策（SameSite Cookie）

## セッション管理
- **HttpOnly Cookie**の使用
- **Secure フラグ**の設定
- **適切なトークン有効期限**の設定
  - Access Token: 1時間
  - Refresh Token: 30日間
- **自動ログアウト**機能（24時間非アクティブ）

## API セキュリティ
- **CORS設定**の適切な管理
- **レート制限**の実装
- **Content Security Policy (CSP)**ヘッダーの設定
- **HSTS (HTTP Strict Transport Security)**ヘッダーの設定

## 禁止事項
- ハードコードされた認証情報の使用
- 平文でのパスワード保存
- 機密情報のログ出力
- 不適切なエラーメッセージの表示（内部情報の漏洩）

## プライバシー・GDPR対応
- **データ最小化**の原則
- **ユーザー同意**の適切な取得
- **データ削除権**の実装
- **データポータビリティ権**の対応

## セキュリティテスト
- 定期的な脆弱性スキャン
- ペネトレーションテストの実施
- 依存関係の脆弱性チェック
- セキュリティコードレビューの実施
